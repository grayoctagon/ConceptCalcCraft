<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Three.js Wood Plates</title>
	<script type="importmap">
		{
			"imports": {
				"three": "https://cdn.jsdelivr.net/npm/three@0.171.0/build/three.module.js",
				"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.171.0/examples/jsm/"
			}
		}
	</script>
	<style>
		body {
			margin: 0px;
			font-family: arial, sans-serif;
		}
		a {
			color: white;
			text-decoration: none;
		}
		.footer {
			position: fixed;
			bottom: 10px;
			width: 100%;
			text-align: center;
		}
	</style>
</head>
<body>
	<script type="module">
		import * as THREE from 'three';
		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		
		// Scene setup
		const scene = new THREE.Scene();
		const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 1000);
		const renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		// OrbitControls for user interaction
		const controls = new OrbitControls(camera, renderer.domElement);

		// Save camera position in localStorage on change
		controls.addEventListener('change', () => {
			const cameraPosition = {
				x: camera.position.x,
				y: camera.position.y,
				z: camera.position.z
			};
			localStorage.setItem('cameraPosition', JSON.stringify(cameraPosition));
			console.log("saved cam pos");
		});

		// Restore camera position from localStorage on load
		const savedCameraPosition = JSON.parse(localStorage.getItem('cameraPosition'));
		if (savedCameraPosition) {
			camera.position.set(
				savedCameraPosition.x,
				savedCameraPosition.y,
				savedCameraPosition.z
			);
		} else {
			camera.position.z = 10;
		}

		// Lighting
		const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
		scene.add(ambientLight);
		const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
		directionalLight.position.set(5, 10, 7.5);
		scene.add(directionalLight);

		// Load wood texture
		const textureLoader = new THREE.TextureLoader();
		const woodTextureURL = "https://threejs.org/examples/textures/hardwood2_diffuse.jpg"; 
		const woodTexture = textureLoader.load(woodTextureURL);

		// Adjust texture scaling and repeat
		woodTexture.wrapS = THREE.RepeatWrapping;
		woodTexture.wrapT = THREE.RepeatWrapping;

		// Load JSON configuration file
		fetch('wood_config.json')
			.then(response => response.json())
			.then(config => {
				config.forEach(plate => createWoodPlate(plate));
				animate();
			})
			.catch(err => console.error('Error loading JSON:', err));

		// Function to create a wood plate
		function createWoodPlate(config) {
			const { width, height, depth, color, position, rotation } = config;
			
			// Create geometry and material
			const geometry = new THREE.BoxGeometry(width, height, depth);
			
			// Adjust texture scaling based on box dimensions
			const materials = [
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null }),
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null }),
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null }),
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null }),
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null }),
				new THREE.MeshStandardMaterial({ map: woodTexture.clone(), side: THREE.DoubleSide, color: color ? new THREE.Color(color) : null })
			];
			
			materials[0].map.repeat.set(depth / width, height / width);
			materials[1].map.repeat.set(depth / width, height / width);
			materials[2].map.repeat.set(width / depth, height / depth);
			materials[3].map.repeat.set(width / depth, height / depth);
			materials[4].map.repeat.set(width / depth, depth / height);
			materials[5].map.repeat.set(width / depth, depth / height);

			// Create mesh
			const plate = new THREE.Mesh(geometry, materials);

			// Set position and rotation
			plate.position.set(position.x, position.y, position.z);
			plate.rotation.set(rotation.x, rotation.y, rotation.z);

			// Add to scene
			scene.add(plate);
		}

		// Animation loop
		function animate() {
			requestAnimationFrame(animate);
			controls.update();
			renderer.render(scene, camera);
		}

		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}

		addEventListener("load", (event) => {
			window.addEventListener('resize', onWindowResize, false);
			onWindowResize();
		});
	</script>
	<div class="footer">
		<a href="https://github.com/grayoctagon/ConceptCalcCraft" target="_blank">Repository: ConceptCalcCraft</a>
	</div>
</body>
</html>
